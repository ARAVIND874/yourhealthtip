<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ஆரோக்கிய நண்பன்</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"></link>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .animate-pulse-slow {
            animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-slow {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        .feature-card {
            min-width: 120px;
        }
        .voice-button.listening {
            animation: pulse-slow 1.5s infinite;
        }
        .voice-button.speaking {
            animation: pulse-slow 1.5s infinite;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">

    <div id="app" class="flex flex-col items-center p-4 sm:p-8">
        <!-- App content will be rendered here by JavaScript -->
    </div>

    <!-- Language Switcher Modal -->
    <div id="lang-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center hidden">
        <div class="relative p-8 bg-white dark:bg-gray-800 rounded-xl shadow-lg w-11/12 max-w-sm mx-4">
            <h3 class="text-xl font-bold mb-4 text-center">{{t.selectLanguage}}</h3>
            <div class="flex justify-center space-x-4">
                <button onclick="switchLanguage('ta'); closeModal('lang-modal');" class="p-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors w-1/2">
                    தமிழ்
                </button>
                <button onclick="switchLanguage('en'); closeModal('lang-modal');" class="p-2 px-4 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors w-1/2">
                    English
                </button>
            </div>
        </div>
    </div>
    
    <!-- Custom Modal for Alerts -->
    <div id="alert-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center hidden">
        <div class="relative p-8 bg-white dark:bg-gray-800 rounded-xl shadow-lg w-11/12 max-w-sm mx-4">
            <h3 id="modal-title" class="text-xl font-bold mb-4"></h3>
            <p id="modal-message" class="text-gray-700 dark:text-gray-300"></p>
            <div class="mt-6 text-right">
                <button onclick="closeModal('alert-modal')" class="p-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                    {{t.alarmModalDismissBtn}}
                </button>
            </div>
        </div>
    </div>

    <script>
        // Translations object
        const translations = {
            ta: {
                loginTitle: 'ஆரோக்கிய நண்பனுக்கு வரவேற்கிறோம்',
                loginDescription: 'தொடர உள்நுழையவும் அல்லது பதிவு செய்யவும்.',
                emailPlaceholder: 'மின்னஞ்சல்',
                passwordPlaceholder: 'கடவுச்சொல்',
                loginBtn: 'உள்நுழை',
                registerBtn: 'பதிவு செய்',
                logoutBtn: 'வெளியேறு',
                mainTitle: 'ஆரோக்கிய நண்பன் - உங்கள் ஆரோக்கிய வழிகாட்டி',
                featuresDescription: 'உங்கள் ஆரோக்கியம் மற்றும் நல்வாழ்வை நிர்வகிக்க அனைத்து அம்சங்களையும் ஆராயுங்கள்.',
                generalHealthTipLabel: 'பொது ஆரோக்கிய குறிப்பு',
                tipSectionTitle: 'ஆரோக்கிய குறிப்பு பெறுங்கள்',
                descriptionText: 'உங்கள் ஆரோக்கிய இலக்கை உள்ளிட்டு தனிப்பயனாக்கப்பட்ட குறிப்புகளைப் பெறுங்கள்!',
                generateBtn: 'குறிப்பு பெறு',
                loadingText: 'குறிப்பு உருவாக்கப்படுகிறது...',
                featuresTitle: 'மேலும் அம்சங்களை ஆராயுங்கள்',
                showFeaturesLabel: 'அம்சங்கள்',
                backToMain: 'முக்கிய பக்கத்திற்கு திரும்பு',
                backToFeatures: 'அம்சங்களுக்கு திரும்பு',
                featuresPageTitle: 'அனைத்து ஆரோக்கிய அம்சங்கள்',
                foodRecipesLabel: 'உணவு செய்முறைகள்',
                stepTrackerLabel: 'படி கண்காணிப்பு',
                heartRateTrackerLabel: 'இதயத் துடிப்பு',
                waterTrackerLabel: 'நீர் உட்கொள்ளல்',
                journalLabel: 'மனநிலை நாட்குறிப்பு',
                localTipsLabel: 'உள்ளூர் குறிப்புகள்',
                mealPlanLabel: 'உணவுத் திட்டம்',
                exerciseYogaLabel: 'உடற்பயிற்சி & யோகா',
                moodAnalysisLabel: 'மனநிலை பகுப்பாய்வு',
                diseasePreventionLabel: 'நோய் தடுப்பு',
                wellnessChallengeLabel: 'ஆரோக்கிய சவால்கள்',
                medicationReminderLabel: 'மருந்து நினைவூட்டல்',
                bodyPainMappingLabel: 'உடல் வலி வரைபடம்',
                firstAidEmergencyLabel: 'முதலுதவி & அவசரம்',
                symptomCheckerLabel: 'அறிகுறி சரிபார்ப்பு',

                // Food Recipes
                foodRecipesTitle: 'உணவு செய்முறைகள்',
                foodRecipesDescription: 'ஒரு உணவின் பெயர் அல்லது மூலப்பொருட்களை உள்ளிட்டு செய்முறையைப் பெறுங்கள்.',
                foodSearchPlaceholder: 'தேடல் செய்முறைகள்...',
                foodSearchBtn: 'தேடு',
                foodLoadingText: 'செய்முறை தேடப்படுகிறது...',
                noRecipesFound: 'செய்முறை எதுவும் கிடைக்கவில்லை. மீண்டும் முயற்சிக்கவும்.',
                ingredientsLabel: 'தேவையான பொருட்கள்',
                instructionsLabel: 'செய்முறை',
                
                // Search box
                searchPlaceholder: 'உங்கள் சந்தேகத்தை இங்கே உள்ளிடவும்...',
                searchLoading: 'உதவிக்குறிப்பு தேடப்படுகிறது...',
                searchBtn: 'தேடு',

                // Step Tracker
                stepSectionTitle: 'படி கண்காணிப்பு',
                startTrackingBtn: 'கண்காணிப்பை தொடங்கு',
                stopTrackingBtn: 'கண்காணிப்பை நிறுத்து',
                resetStepsBtn: 'படிகளை மீட்டமை',
                stepResultOutputDefault: 'உங்கள் தினசரி படிகளை இங்கே கண்காணிக்கவும்!',
                stepTipOutputDefault: 'ஒரு நாளைக்கு 10,000 படிகள் நடப்பது உங்கள் ஆரோக்கியத்தை கணிசமாக மேம்படுத்தும்.',

                // Heart Rate Tracker
                heartRateSectionTitle: 'இதயத் துடிப்பு கண்காணிப்பு',
                startMeasuringBtn: 'துடிப்பை அளக்க தொடங்கு',
                stopMeasuringBtn: 'அளப்பதை நிறுத்து',
                resetHeartRateBtn: 'இதயத் துடிப்பை மீட்டமை',
                heartRateResultOutputDefault: 'சிறந்த ஆரோக்கியத்திற்காக உங்கள் இதயத் துடிப்பை கண்காணிக்கவும்.',
                heartRateTipOutputDefault: 'ஓய்வு நேரத்தில் இதயத் துடிப்பு 60-100 BPM பொதுவாக பெரியவர்களுக்கு சாதாரணமாகக் கருதப்படுகிறது.',

                // Water Tracker
                waterSectionTitle: 'நீர் உட்கொள்ளல் கண்காணிப்பு',
                addWaterBtn: '250 மிலி சேர்',
                resetWaterBtn: 'நீரை மீட்டமை',
                waterResultOutputDefault: 'உங்கள் தினசரி நீர் உட்கொள்ளலை கண்காணிக்கவும்.',
                waterTipOutputDefault: 'சரியான நீரேற்றத்திற்கு ஒரு நாளைக்கு குறைந்தது 8 கிளாஸ் தண்ணீர் குடிக்கவும்.',
                waterIntakeTitle: 'நீர் உட்கொள்ளல்',

                // Journal
                journalSectionTitle: 'மனநிலை & நன்றியுணர்வு நாட்குறிப்பு',
                journalDescription: 'உங்கள் மனநிலையையும், நீங்கள் நன்றியுள்ள விஷயங்களையும் தினமும் பதிவு செய்யுங்கள்.',
                saveJournalEntryBtn: 'பதிவை சேமி',
                journalEntriesOutputDefault: 'உங்கள் நாட்குறிப்பு பதிவுகள் இங்கே தோன்றும்.',
                analyzeMoodJournalBtn: 'மனநிலையை பகுப்பாய்வு செய்',
                moodAnalysisOutputDefault: 'உங்கள் மனநிலை பகுப்பாய்வு இங்கே தோன்றும்.',
                
                // Medication Reminder
                medicationTitle: 'மருந்து நினைவூட்டல்',
                medicineNamePlaceholder: 'மருந்தின் பெயர்',
                dosagePlaceholder: 'அளவு (எ.கா: 1 மாத்திரை)',
                timePlaceholder: 'நேரம் (HH:MM)',
                addMedicationBtn: 'மருந்தை சேர்',
                medicationListTitle: 'உங்கள் மருந்து நினைவூட்டல்கள்',
                noMedications: 'மருந்து நினைவூட்டல்கள் எதுவும் இல்லை.',
                
                // Body Pain Map
                painMapTitle: 'உடல் வலி வரைபடம்',
                painMapDescription: 'உடலின் எந்தப் பகுதியில் வலி இருக்கிறதோ, அதைத் தொட்டு வலி மற்றும் அதன் விளக்கத்தை சேர்க்கவும்.',
                painMapNote: 'நீங்கள் வலியை நீக்க அதை மீண்டும் அழுத்தலாம்.',
                painDescriptionPlaceholder: 'வலியின் விளக்கம்...',
                savePainPointBtn: 'சேமி',
                
                // First Aid & Emergency
                firstAidEmergencyTitle: 'முதலுதவி & அவசரம்',
                firstAidDescription: 'அவசர காலங்களில் உதவிகள் மற்றும் தகவல்களை பெறவும்.',
                emergencyContactsTitle: 'அவசர தொடர்புகள்',
                contactNamePlaceholder: 'பெயர்',
                contactNumberPlaceholder: 'அலைபேசி எண்',
                addContactBtn: 'தொடர்பை சேர்',
                callBtn: 'அழைப்பு',
                
                // All other AI-powered features
                aiTipTitle: 'AI உதவிக்குறிப்பு',
                aiTipPlaceholder: 'உங்கள் குறிப்பு இங்கே தோன்றும்.',
                
                // Modals & Alerts
                modalSuccessTitle: 'வெற்றி!',
                modalErrorTitle: 'பிழை!',
                modalSaveSuccess: 'உங்கள் தரவு வெற்றிகரமாக சேமிக்கப்பட்டது!',
                modalSaveError: 'தரவைச் சேமிக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.',
                modalMedicineAdded: 'மருந்து வெற்றிகரமாக சேர்க்கப்பட்டது!',
                modalMedicineRemoved: 'மருந்து வெற்றிகரமாக அகற்றப்பட்டது!',
                modalMedicineError: 'மருந்து சேர்க்க முடியவில்லை. அனைத்து புலங்களையும் நிரப்பவும்.',
                modalAuthError: 'அங்கீகாரம் தோல்வியடைந்தது. பக்கத்தை புதுப்பிக்கவும்.',
                modalJournalSaved: 'நாட்குறிப்பு பதிவு சேமிக்கப்பட்டது!',
                modalJournalError: 'நாட்குறிப்பு பதிவைச் சேமிக்க முடியவில்லை.',
                modalPainPointSaved: 'வலி புள்ளி சேமிக்கப்பட்டது!',
                modalPainPointRemoved: 'வலி புள்ளி அகற்றப்பட்டது!',
                modalPainPointError: 'வலி புள்ளியைச் சேமிக்க முடியவில்லை. தயவுசெய்து ஒரு விளக்கத்தை வழங்கவும்.',
                modalContactAdded: 'அவசர தொடர்பு சேர்க்கப்பட்டது!',
                modalContactRemoved: 'அவசர தொடர்பு அகற்றப்பட்டது!',
                modalContactError: 'தொடர்பைச் சேர்க்க முடியவில்லை. அனைத்து புலங்களையும் நிரப்பவும்.',
                alarmModalTitle: 'மருந்து நினைவூட்டல்!',
                alarmModalMessage: 'உங்கள் மருந்தை எடுத்துக்கொள்ள வேண்டிய நேரம்: ',
                alarmModalDismissBtn: 'நீக்கு',
                speechRecognitionError: 'பேச்சு அங்கீகாரம் ஆதரிக்கப்படவில்லை அல்லது அனுமதி மறுக்கப்பட்டது.',
                speechRecognitionNoMatch: 'ஆடியோவை புரிந்து கொள்ள முடியவில்லை. மீண்டும் முயற்சிக்கவும்.',
                speechRecognitionListening: 'கேட்கிறது...',
                speechRecognitionProcessing: 'ஆடியோ செயலாக்கப்படுகிறது...',
                ttsError: 'ஆடியோவை உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.',
                ttsSpeaking: 'பேசுகிறது...',
                ttsLoadingVoices: 'குரல்கள் ஏற்றப்படுகிறது...',
                ttsNoVoices: 'இந்த மொழிக்கு குரல்கள் கிடைக்கவில்லை.',
                selectLanguage: 'மொழித் தேர்வு',
            },
            en: {
                loginTitle: 'Welcome to Health Buddy',
                loginDescription: 'Please login or register to continue.',
                emailPlaceholder: 'Email',
                passwordPlaceholder: 'Password',
                loginBtn: 'Login',
                registerBtn: 'Register',
                logoutBtn: 'Logout',
                mainTitle: 'Health Buddy - Your Health Guide',
                featuresDescription: 'Explore all the features to manage your health and well-being.',
                generalHealthTipLabel: 'General Health Tip',
                tipSectionTitle: 'Get a Health Tip',
                descriptionText: 'Enter your health goal and get personalized tips!',
                generateBtn: 'Get Tip',
                loadingText: 'Generating tip...',
                featuresTitle: 'Explore More Features',
                showFeaturesLabel: 'Features',
                backToMain: 'Back to Main',
                backToFeatures: 'Back to Features',
                featuresPageTitle: 'All Health Features',
                foodRecipesLabel: 'Food Recipes',
                stepTrackerLabel: 'Step Tracker',
                heartRateTrackerLabel: 'Heart Rate',
                waterTrackerLabel: 'Water Intake',
                journalLabel: 'Mood Journal',
                localTipsLabel: 'Local Tips',
                mealPlanLabel: 'Meal Plan',
                exerciseYogaLabel: 'Exercise & Yoga',
                moodAnalysisLabel: 'Mood Analysis',
                diseasePreventionLabel: 'Disease Prevention',
                wellnessChallengeLabel: 'Wellness Challenges',
                medicationReminderLabel: 'Medication Reminder',
                bodyPainMappingLabel: 'Body Pain Map',
                firstAidEmergencyLabel: 'First Aid & Emergency',
                symptomCheckerLabel: 'Symptom Checker',

                // Food Recipes
                foodRecipesTitle: 'Food Recipes',
                foodRecipesDescription: 'Enter a food name or ingredients to get a recipe.',
                foodSearchPlaceholder: 'Search recipes...',
                foodSearchBtn: 'Search',
                foodLoadingText: 'Searching for recipe...',
                noRecipesFound: 'No recipes found. Please try again.',
                ingredientsLabel: 'Ingredients',
                instructionsLabel: 'Instructions',
                
                // Search box
                searchPlaceholder: 'Enter your query here...',
                searchLoading: 'Searching for a tip...',
                searchBtn: 'Search',

                // Step Tracker
                stepSectionTitle: 'Step Tracker',
                startTrackingBtn: 'Start Tracking',
                stopTrackingBtn: 'Stop Tracking',
                resetStepsBtn: 'Reset Steps',
                stepResultOutputDefault: 'Track your daily steps here!',
                stepTipOutputDefault: 'Walking 10,000 steps a day can significantly improve your health.',

                // Heart Rate Tracker
                heartRateSectionTitle: 'Heart Rate Tracker',
                startMeasuringBtn: 'Start Measuring',
                stopMeasuringBtn: 'Stop Measuring',
                resetHeartRateBtn: 'Reset Heart Rate',
                heartRateResultOutputDefault: 'Track your heart rate for better health.',
                heartRateTipOutputDefault: 'A resting heart rate of 60-100 BPM is generally considered normal for adults.',

                // Water Tracker
                waterSectionTitle: 'Water Intake Tracker',
                addWaterBtn: 'Add 250 ml',
                resetWaterBtn: 'Reset Water',
                waterResultOutputDefault: 'Track your daily water intake.',
                waterTipOutputDefault: 'Drink at least 8 glasses of water a day for proper hydration.',
                waterIntakeTitle: 'Water Intake',

                // Journal
                journalSectionTitle: 'Mood & Gratitude Journal',
                journalDescription: 'Record your mood and what you are grateful for each day.',
                saveJournalEntryBtn: 'Save Entry',
                journalEntriesOutputDefault: 'Your journal entries will appear here.',
                analyzeMoodJournalBtn: 'Analyze Mood',
                moodAnalysisOutputDefault: 'Your mood analysis will appear here.',
                
                // Medication Reminder
                medicationTitle: 'Medication Reminder',
                medicineNamePlaceholder: 'Medicine Name',
                dosagePlaceholder: 'Dosage (e.g., 1 tablet)',
                timePlaceholder: 'Time (HH:MM)',
                addMedicationBtn: 'Add Medicine',
                medicationListTitle: 'Your Medication Reminders',
                noMedications: 'No medication reminders set.',

                // Body Pain Map
                painMapTitle: 'Body Pain Map',
                painMapDescription: 'Tap on a body part to add a pain description.',
                painMapNote: 'You can tap on the pain point again to remove it.',
                painDescriptionPlaceholder: 'Description of pain...',
                savePainPointBtn: 'Save',

                // First Aid & Emergency
                firstAidEmergencyTitle: 'First Aid & Emergency',
                firstAidDescription: 'Get help and information for emergencies.',
                emergencyContactsTitle: 'Emergency Contacts',
                contactNamePlaceholder: 'Name',
                contactNumberPlaceholder: 'Phone Number',
                addContactBtn: 'Add Contact',
                callBtn: 'Call',
                
                // All other AI-powered features
                aiTipTitle: 'AI Tip',
                aiTipPlaceholder: 'Your tip will appear here.',

                // Modals & Alerts
                modalSuccessTitle: 'Success!',
                modalErrorTitle: 'Error!',
                modalSaveSuccess: 'Your data has been saved successfully!',
                modalSaveError: 'Failed to save data. Please try again.',
                modalMedicineAdded: 'Medicine added successfully!',
                modalMedicineRemoved: 'Medicine removed successfully!',
                modalMedicineError: 'Failed to add medicine. Please fill all fields.',
                modalAuthError: 'Authentication failed. Please refresh the page.',
                modalJournalSaved: 'Journal entry saved!',
                modalJournalError: 'Failed to save journal entry.',
                modalPainPointSaved: 'Pain point saved!',
                modalPainPointRemoved: 'Pain point removed!',
                modalPainPointError: 'Failed to save pain point. Please provide a description.',
                modalContactAdded: 'Emergency contact added!',
                modalContactRemoved: 'Emergency contact removed!',
                modalContactError: 'Failed to add contact. Please fill all fields.',
                alarmModalTitle: 'Medication Reminder!',
                alarmModalMessage: 'It\'s time to take your medicine: ',
                alarmModalDismissBtn: 'Dismiss',
                speechRecognitionError: 'Speech recognition is not supported or permission was denied.',
                speechRecognitionNoMatch: 'Could not understand the audio. Please try again.',
                speechRecognitionListening: 'Listening...',
                speechRecognitionProcessing: 'Processing audio...',
                ttsError: 'Failed to generate audio. Please try again.',
                ttsSpeaking: 'Speaking...',
                ttsLoadingVoices: 'Loading voices...',
                ttsNoVoices: 'No voices available for this language.',
                selectLanguage: 'Select Language',
            },
        };

        let currentLang = 'ta';
        let t = translations[currentLang];
        let isAuthenticated = false;
        let currentPage = 'login';
        
        // State variables for the app
        let steps = 0;
        let isStepTracking = false;
        let stepInterval = null;

        let heartRate = 0;
        let isHeartRateMeasuring = false;
        let heartRateInterval = null;
        
        let waterIntake = 0;
        let journalEntry = '';
        let journalEntries = JSON.parse(localStorage.getItem('journalEntries')) || [];
        let moodAnalysis = '';
        let healthTipInput = '';
        let healthTipOutput = '';
        let isLoading = false;
        let isSearchLoading = false;
        let aiTipOutput = '';
        let foodRecipeQuery = '';
        let foodRecipes = [];
        let isFoodLoading = false;
        let medications = JSON.parse(localStorage.getItem('medications')) || [];
        let painPoints = JSON.parse(localStorage.getItem('painPoints')) || {};
        let emergencyContacts = JSON.parse(localStorage.getItem('emergencyContacts')) || [];

        // Speech API
        let isListening = false;
        let isSpeaking = false;
        let recognition = null;
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.onstart = () => {
                isListening = true;
                renderPage();
            };
            recognition.onend = () => {
                isListening = false;
                renderPage();
            };
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                showModal(t.modalErrorTitle, t.speechRecognitionError);
                isListening = false;
                renderPage();
            };
        }

        const apiKey = ""; // API key is automatically provided at runtime

        // Helper functions for TTS/Audio
        const pcmToWav = (pcmData, sampleRate) => {
            const buffer = new ArrayBuffer(44 + pcmData.byteLength);
            const view = new DataView(buffer);
            const writeString = (view, offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcmData.byteLength, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true); // PCM
            view.setUint16(22, 1, true); // Mono
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true); // Bytes per second
            view.setUint16(32, 2, true); // Block align
            view.setUint16(34, 16, true); // Bits per sample
            writeString(view, 36, 'data');
            view.setUint32(40, pcmData.byteLength, true);
            new Int16Array(buffer, 44).set(new Int16Array(pcmData));
            return new Blob([buffer], { type: 'audio/wav' });
        };

        const base64ToArrayBuffer = (base64) => {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        };
        
        function showModal(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('alert-modal').classList.remove('hidden');
            document.getElementById('alert-modal').classList.add('flex');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
            document.getElementById(id).classList.remove('flex');
        }

        async function callApiWithBackoff(apiCall, maxRetries = 5, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const result = await apiCall();
                    return result;
                } catch (error) {
                    if (i < maxRetries - 1) {
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    } else {
                        throw error;
                    }
                }
            }
        }

        function switchLanguage(lang) {
            currentLang = lang;
            t = translations[currentLang];
            renderPage();
        }

        // Feature-specific logic
        
        async function generateHealthTip() {
            const input = document.getElementById('healthTipInput').value;
            if (!input.trim()) {
                showModal(t.modalErrorTitle, "தயவுசெய்து உங்கள் ஆரோக்கிய இலக்கை உள்ளிடவும்.");
                return;
            }
            isLoading = true;
            renderPage();
            try {
                const langName = currentLang === 'ta' ? 'தமிழ்' : 'English';
                const prompt = `User's health goal: "${input}". Based on this goal, generate a short, useful, personalized health tip in ${langName}. The tip should be under 50 words.`;
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiCall = async () => {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return response.json();
                };
                const result = await callApiWithBackoff(apiCall);
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    healthTipOutput = result.candidates[0].content.parts[0].text;
                } else {
                    healthTipOutput = 'குறிப்பு உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.';
                }
            } catch (error) {
                console.error("API error:", error);
                healthTipOutput = 'குறிப்பு உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.';
            } finally {
                isLoading = false;
                renderPage();
            }
        }
        
        async function getFoodRecipes() {
            const query = document.getElementById('foodRecipeInput').value;
            if (!query.trim()) {
                showModal(t.modalErrorTitle, "தயவுசெய்து செய்முறையை உள்ளிடவும்.");
                return;
            }
            isFoodLoading = true;
            renderPage();
            foodRecipes = []; // Clear previous recipes
            try {
                const prompt = `செய்முறையின் பெயர் "${query}" அல்லது அதில் உள்ள பொருட்கள் "${query}"-ஐ அடிப்படையாகக் கொண்டு, தமிழில் 3 உணவு செய்முறைகளைக் கண்டறிந்து, ஒவ்வொரு செய்முறைக்கும் தேவையான பொருட்கள் மற்றும் செய்முறை வழிமுறைகளுடன் ஒரு JSON கட்டமைப்பில் உள்ளீட்டை வழங்கவும். JSON கட்டமைப்பு பின்வருமாறு இருக்க வேண்டும்: Array of Objects, ஒவ்வொரு பொருளுக்கும் "recipeName", "ingredients" (Array of Strings), மற்றும் "instructions" (Array of Strings).`;
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { 
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: {
                                type: "OBJECT",
                                properties: {
                                    "recipeName": { "type": "STRING" },
                                    "ingredients": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    },
                                    "instructions": {
                                        "type": "ARRAY",
                                        "items": { "type": "STRING" }
                                    }
                                },
                            }
                        }
                    }
                };

                const apiCall = async () => {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return response.json();
                };
                
                const result = await callApiWithBackoff(apiCall);

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const json = result.candidates[0].content.parts[0].text;
                    foodRecipes = JSON.parse(json);
                } else {
                    foodRecipes = [];
                    showModal(t.modalErrorTitle, t.noRecipesFound);
                }
            } catch (error) {
                console.error("API error:", error);
                foodRecipes = [];
                showModal(t.modalErrorTitle, t.noRecipesFound);
            } finally {
                isFoodLoading = false;
                renderPage();
            }
        }
        
        async function getAiTipForQuery(query, featureName) {
            if (!query.trim()) {
                showModal(t.modalErrorTitle, "தயவுசெய்து உங்கள் சந்தேகத்தை உள்ளிடவும்.");
                return;
            }
            isSearchLoading = true;
            renderPage();

            try {
                const langName = currentLang === 'ta' ? 'தமிழ்' : 'English';
                const prompt = `"${featureName}" என்ற தலைப்பில் உள்ள பயனர் சந்தேகம்: "${query}". இந்த சந்தேகத்திற்கு ${langName}-ல் ஒரு விரிவான, பயனுள்ள குறிப்பை வழங்குங்கள்.`;
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                
                const apiCall = async () => {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return response.json();
                };
                
                const result = await callApiWithBackoff(apiCall);

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiTipOutput = result.candidates[0].content.parts[0].text;
                } else {
                    aiTipOutput = 'உதவிக்குறிப்பு உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.';
                }
            } catch (error) {
                console.error("API error:", error);
                aiTipOutput = 'உதவிக்குறிப்பு உருவாக்க முடியவில்லை. மீண்டும் முயற்சிக்கவும்.';
            } finally {
                isSearchLoading = false;
                renderPage();
            }
        }

        async function analyzeMood() {
            if (journalEntries.length === 0) {
                showModal(t.modalErrorTitle, "பகுப்பாய்வு செய்ய நாட்குறிப்பு பதிவுகள் இல்லை.");
                return;
            }
            isLoading = true;
            renderPage();

            try {
                const prompt = `இந்த நாட்குறிப்பு பதிவுகளை பகுப்பாய்வு செய்து, பயனரின் ஒட்டுமொத்த மனநிலை போக்கைப் பற்றி தமிழில் ஒரு சுருக்கமான, ஆதரவான சுருக்கத்தை வழங்கவும். முடிந்தால் நேர்மறை, எதிர்மறை அல்லது நடுநிலை மனநிலைகளை அடையாளம் காணவும். பதிவுகள்: ${journalEntries.map(e => e.entry).join('; ')}`;
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiCall = async () => {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return response.json();
                };
                
                const result = await callApiWithBackoff(apiCall);

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    moodAnalysis = result.candidates[0].content.parts[0].text;
                } else {
                    moodAnalysis = 'மனநிலை பகுப்பாய்வு செய்ய முடியவில்லை. மீண்டும் முயற்சிக்கவும்.';
                }
            } catch (error) {
                console.error("API error:", error);
                moodAnalysis = 'மனநிலை பகுப்பாய்வு செய்ய முடியவில்லை. மீண்டும் முயற்சிக்கவும்.';
            } finally {
                isLoading = false;
                renderPage();
            }
        }
        
        // General purpose functions for the new features
        function startStepTracking() {
            if (!isStepTracking) {
                isStepTracking = true;
                stepInterval = setInterval(() => {
                    steps++;
                    renderPage();
                }, 1000); // Simulating one step per second
            }
        }

        function stopStepTracking() {
            isStepTracking = false;
            if (stepInterval) clearInterval(stepInterval);
        }

        function resetSteps() {
            steps = 0;
            renderPage();
        }
        
        function startHeartRateMeasuring() {
            if (!isHeartRateMeasuring) {
                isHeartRateMeasuring = true;
                heartRateInterval = setInterval(() => {
                    heartRate = Math.floor(60 + Math.random() * 40); // Simulate BPM
                    renderPage();
                }, 2000);
            }
        }

        function stopHeartRateMeasuring() {
            isHeartRateMeasuring = false;
            if (heartRateInterval) clearInterval(heartRateInterval);
        }
        
        function resetHeartRate() {
            heartRate = 0;
            renderPage();
        }

        function addWater() {
            waterIntake += 250;
            renderPage();
        }

        function resetWater() {
            waterIntake = 0;
            renderPage();
        }

        function saveJournalEntry() {
            const entryText = document.getElementById('journalEntryInput').value;
            if (entryText.trim()) {
                journalEntries.push({ date: new Date().toLocaleDateString(), entry: entryText });
                localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                document.getElementById('journalEntryInput').value = '';
                showModal(t.modalSuccessTitle, t.modalJournalSaved);
                renderPage();
            } else {
                showModal(t.modalErrorTitle, t.modalJournalError);
            }
        }

        function addMedication() {
            const name = document.getElementById('medicineName').value;
            const dosage = document.getElementById('dosage').value;
            const time = document.getElementById('medicationTime').value;
            if (name && dosage && time) {
                medications.push({ name, dosage, time });
                localStorage.setItem('medications', JSON.stringify(medications));
                document.getElementById('medicineName').value = '';
                document.getElementById('dosage').value = '';
                document.getElementById('medicationTime').value = '';
                showModal(t.modalSuccessTitle, t.modalMedicineAdded);
                renderPage();
            } else {
                showModal(t.modalErrorTitle, t.modalMedicineError);
            }
        }

        function removeMedication(index) {
            medications.splice(index, 1);
            localStorage.setItem('medications', JSON.stringify(medications));
            showModal(t.modalSuccessTitle, t.modalMedicineRemoved);
            renderPage();
        }

        function startAlarmCheck() {
            setInterval(() => {
                const now = new Date();
                const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                medications.forEach(med => {
                    if (med.time === currentTime) {
                        showModal(t.alarmModalTitle, `${t.alarmModalMessage} ${med.name}`);
                    }
                });
            }, 60000); // Check every minute
        }
        
        function handlePainPointClick(event) {
            const part = event.target.id;
            const isPainPoint = painPoints.hasOwnProperty(part);

            if (isPainPoint) {
                delete painPoints[part];
                localStorage.setItem('painPoints', JSON.stringify(painPoints));
                showModal(t.modalSuccessTitle, t.modalPainPointRemoved);
            } else {
                const description = prompt(t.painDescriptionPlaceholder);
                if (description) {
                    painPoints[part] = description;
                    localStorage.setItem('painPoints', JSON.stringify(painPoints));
                    showModal(t.modalSuccessTitle, t.modalPainPointSaved);
                } else {
                    showModal(t.modalErrorTitle, t.modalPainPointError);
                }
            }
            renderPage();
        }

        function addEmergencyContact() {
            const name = document.getElementById('contactName').value;
            const number = document.getElementById('contactNumber').value;
            if (name && number) {
                emergencyContacts.push({ name, number });
                localStorage.setItem('emergencyContacts', JSON.stringify(emergencyContacts));
                document.getElementById('contactName').value = '';
                document.getElementById('contactNumber').value = '';
                showModal(t.modalSuccessTitle, t.modalContactAdded);
                renderPage();
            } else {
                showModal(t.modalErrorTitle, t.modalContactError);
            }
        }

        function removeEmergencyContact(index) {
            emergencyContacts.splice(index, 1);
            localStorage.setItem('emergencyContacts', JSON.stringify(emergencyContacts));
            showModal(t.modalSuccessTitle, t.modalContactRemoved);
            renderPage();
        }
        
        function callContact(number) {
             window.location.href = `tel:${number}`;
        }

        // Voice API functions
        function startListening(inputElementId, callback) {
            if (!recognition) {
                showModal(t.modalErrorTitle, t.speechRecognitionError);
                return;
            }
            recognition.lang = currentLang === 'ta' ? 'ta-IN' : 'en-US';
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                document.getElementById(inputElementId).value = transcript;
                if (callback) callback(transcript);
            };
            recognition.start();
        }
        
        async function speakText(text) {
            if (isSpeaking || !text.trim()) return;
            isSpeaking = true;
            renderPage();
            try {
                const payload = {
                    contents: [{ parts: [{ text }] }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: { voiceName: currentLang === 'ta' ? 'Algieba' : 'Leda' }
                            }
                        }
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };

                const apiCall = async () => {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API request failed');
                    return response.json();
                };

                const result = await callApiWithBackoff(apiCall);
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/")) {
                    const audioBuffer = base64ToArrayBuffer(audioData);
                    const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                    const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 16000;
                    const pcm16 = new Int16Array(audioBuffer);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    const audio = new Audio(audioUrl);
                    audio.onended = () => {
                        isSpeaking = false;
                        renderPage();
                    };
                    audio.play();
                } else {
                    throw new Error('No audio data received');
                }
            } catch (error) {
                console.error("TTS Error:", error);
                showModal(t.modalErrorTitle, t.ttsError);
                isSpeaking = false;
                renderPage();
            }
        }
        
        function login() {
            isAuthenticated = true;
            currentPage = 'main';
            startAlarmCheck();
            renderPage();
        }

        function logout() {
            isAuthenticated = false;
            currentPage = 'login';
            renderPage();
        }

        // --- Render Functions for different pages ---

        function renderLoginPage() {
            return `
                <div class="flex flex-col items-center justify-center min-h-screen p-4">
                    <h1 class="text-3xl sm:text-4xl font-bold mb-2 text-center text-blue-600 dark:text-blue-400 text-shadow">
                        ${t.loginTitle}
                    </h1>
                    <p class="text-sm sm:text-base text-gray-700 dark:text-gray-300 mb-6 text-center">
                        ${t.loginDescription}
                    </p>
                    <div class="w-full max-w-sm bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 sm:p-8 space-y-4">
                        <input type="email" id="email" placeholder="${t.emailPlaceholder}" class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                        <input type="password" id="password" placeholder="${t.passwordPlaceholder}" class="w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <button onclick="login()" class="w-full sm:w-1/2 p-3 rounded-xl text-white font-bold bg-blue-500 hover:bg-blue-600 transition-colors shadow-lg">
                                ${t.loginBtn}
                            </button>
                            <button onclick="login()" class="w-full sm:w-1/2 p-3 rounded-xl text-blue-500 font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors shadow-lg">
                                ${t.registerBtn}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHeader() {
            return `
                <header class="w-full flex justify-between items-center py-4 px-2 sm:px-4 mb-6">
                    <h1 class="text-2xl sm:text-3xl font-bold text-blue-600 dark:text-blue-400">
                        ${t.mainTitle}
                    </h1>
                    <div class="flex items-center space-x-2">
                        <button onclick="document.getElementById('lang-modal').classList.remove('hidden');" class="p-2 rounded-full text-blue-600 dark:text-blue-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-globe text-xl"></i>
                        </button>
                        <button onclick="logout()" class="p-2 px-4 rounded-full text-white bg-red-500 hover:bg-red-600 transition-colors text-sm sm:text-base">
                            ${t.logoutBtn}
                        </button>
                    </div>
                </header>
            `;
        }
        
        function renderMainPage() {
            const loadingHtml = isLoading ? `
                <div class="flex items-center justify-center p-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <span class="ml-4 text-blue-500">${t.loadingText}</span>
                </div>
            ` : '';
            
            const tipOutputHtml = healthTipOutput ? `
                <div class="mt-4 p-4 bg-gray-200 dark:bg-gray-700 rounded-lg">
                    <p class="text-gray-800 dark:text-gray-200">${healthTipOutput}</p>
                </div>
                <div class="mt-4 flex justify-end">
                    <button onclick="speakText('${healthTipOutput.replace(/'/g, "\\'")}')" class="p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors voice-button ${isSpeaking ? 'speaking' : ''}">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            ` : '';

            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl space-y-6">
                    <!-- General Health Tip Section -->
                    <div class="bg-gradient-to-r from-blue-400 to-blue-600 dark:from-blue-600 dark:to-blue-800 p-6 rounded-2xl shadow-lg text-white">
                        <h2 class="text-2xl sm:text-3xl font-bold mb-2">${t.tipSectionTitle}</h2>
                        <p class="text-sm sm:text-base opacity-90 mb-4">${t.descriptionText}</p>
                        <div class="flex items-center space-x-2">
                            <input type="text" id="healthTipInput" placeholder="${t.searchPlaceholder}" value="${healthTipInput}" class="flex-grow p-3 rounded-lg border-none focus:outline-none text-gray-900 bg-white">
                            <button onclick="startListening('healthTipInput')" class="p-3 bg-blue-700 hover:bg-blue-800 transition-colors rounded-lg text-white voice-button ${isListening ? 'listening' : ''}">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                        <button onclick="generateHealthTip()" class="w-full mt-4 p-3 rounded-xl bg-blue-700 hover:bg-blue-800 transition-colors font-bold shadow-md">
                            ${t.generateBtn}
                        </button>
                        ${loadingHtml}
                        ${tipOutputHtml}
                    </div>

                    <!-- Features Section -->
                    <div class="flex flex-col items-center">
                        <button onclick="navigateTo('features')" class="p-3 px-6 rounded-full text-white font-bold bg-purple-500 hover:bg-purple-600 transition-colors shadow-lg">
                            ${t.showFeaturesLabel}
                        </button>
                    </div>
                </main>
            `;
        }

        function renderFeaturesPage() {
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-purple-600 dark:text-purple-400">${t.featuresPageTitle}</h2>
                        <button onclick="navigateTo('main')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToMain}
                        </button>
                    </div>

                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 sm:gap-6">
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('foodRecipes')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-yellow-400 text-white rounded-2xl shadow-lg hover:bg-yellow-500 transition-colors">
                                <i class="fas fa-utensils text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.foodRecipesLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('stepTracker')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-green-500 text-white rounded-2xl shadow-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-walking text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.stepTrackerLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('heartRate')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-red-500 text-white rounded-2xl shadow-lg hover:bg-red-600 transition-colors">
                                <i class="fas fa-heartbeat text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.heartRateTrackerLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('waterTracker')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-blue-500 text-white rounded-2xl shadow-lg hover:bg-blue-600 transition-colors">
                                <i class="fas fa-glass-whiskey text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.waterTrackerLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('journal')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-indigo-500 text-white rounded-2xl shadow-lg hover:bg-indigo-600 transition-colors">
                                <i class="fas fa-book-open text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.journalLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('localTips')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-orange-500 text-white rounded-2xl shadow-lg hover:bg-orange-600 transition-colors">
                                <i class="fas fa-map-marked-alt text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.localTipsLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('mealPlan')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-teal-500 text-white rounded-2xl shadow-lg hover:bg-teal-600 transition-colors">
                                <i class="fas fa-apple-alt text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.mealPlanLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('exerciseYoga')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-pink-500 text-white rounded-2xl shadow-lg hover:bg-pink-600 transition-colors">
                                <i class="fas fa-dumbbell text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.exerciseYogaLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('diseasePrevention')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-cyan-500 text-white rounded-2xl shadow-lg hover:bg-cyan-600 transition-colors">
                                <i class="fas fa-shield-alt text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.diseasePreventionLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('wellnessChallenges')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-lime-500 text-white rounded-2xl shadow-lg hover:bg-lime-600 transition-colors">
                                <i class="fas fa-medal text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.wellnessChallengeLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('medicationReminder')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-purple-500 text-white rounded-2xl shadow-lg hover:bg-purple-600 transition-colors">
                                <i class="fas fa-pills text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.medicationReminderLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('bodyPainMap')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-fuchsia-500 text-white rounded-2xl shadow-lg hover:bg-fuchsia-600 transition-colors">
                                <i class="fas fa-map-pin text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.bodyPainMappingLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('firstAid')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-red-600 text-white rounded-2xl shadow-lg hover:bg-red-700 transition-colors">
                                <i class="fas fa-first-aid text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.firstAidEmergencyLabel}</span>
                            </button>
                        </div>
                        <div class="flex flex-col items-center">
                            <button onclick="navigateTo('symptomChecker')" class="feature-card flex flex-col items-center justify-center w-24 h-24 sm:w-32 sm:h-32 bg-emerald-500 text-white rounded-2xl shadow-lg hover:bg-emerald-600 transition-colors">
                                <i class="fas fa-stethoscope text-3xl sm:text-4xl"></i>
                                <span class="text-center mt-2 text-xs sm:text-sm font-bold">${t.symptomCheckerLabel}</span>
                            </button>
                        </div>
                    </div>
                </main>
            `;
        }
        
        function renderFoodRecipesPage() {
            const loadingHtml = isFoodLoading ? `
                <div class="flex items-center justify-center p-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-500"></div>
                    <span class="ml-4 text-yellow-500">${t.foodLoadingText}</span>
                </div>
            ` : '';

            const recipesHtml = foodRecipes.map(recipe => `
                <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-xl shadow-md">
                    <h3 class="text-xl font-bold text-yellow-600 dark:text-yellow-400 mb-2">${recipe.recipeName}</h3>
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200">${t.ingredientsLabel}</h4>
                        <ul class="list-disc list-inside text-gray-700 dark:text-gray-300">
                            ${recipe.ingredients.map(ingredient => `<li>${ingredient}</li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200">${t.instructionsLabel}</h4>
                        <ol class="list-decimal list-inside text-gray-700 dark:text-gray-300">
                            ${recipe.instructions.map(instruction => `<li>${instruction}</li>`).join('')}
                        </ol>
                    </div>
                </div>
            `).join('');

            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-yellow-600 dark:text-yellow-400" id="feature-title">${t.foodRecipesTitle}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>

                    <div class="mb-4 flex items-center space-x-2">
                        <input type="text" id="foodRecipeInput" placeholder="${t.foodSearchPlaceholder}" class="flex-grow p-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                        <button onclick="startListening('foodRecipeInput')" class="p-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors voice-button ${isListening ? 'listening' : ''}">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button onclick="getFoodRecipes()" class="p-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    ${loadingHtml}
                    <div class="space-y-4">
                        ${recipesHtml}
                    </div>
                </main>
            `;
        }

        function renderTrackerPage(title, value, unit, startBtnText, stopBtnText, resetBtnText, tipText, startFunc, stopFunc, resetFunc) {
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-green-600 dark:text-green-400" id="feature-title">${title}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>

                    <div class="flex flex-col items-center justify-center p-8 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl shadow-lg text-white mb-6">
                        <div class="text-5xl sm:text-7xl font-extrabold text-shadow">${value}</div>
                        <div class="text-xl sm:text-2xl mt-2 font-semibold">${unit}</div>
                    </div>

                    <div class="flex flex-wrap justify-center space-x-2 sm:space-x-4 mb-6">
                        <button onclick="${startFunc}" class="p-3 px-6 rounded-xl font-bold text-white bg-green-500 hover:bg-green-600 transition-colors shadow-lg">
                            ${startBtnText}
                        </button>
                        <button onclick="${stopFunc}" class="p-3 px-6 rounded-xl font-bold text-white bg-red-500 hover:bg-red-600 transition-colors shadow-lg">
                            ${stopBtnText}
                        </button>
                        <button onclick="${resetFunc}" class="p-3 px-6 rounded-xl font-bold text-gray-900 bg-gray-200 hover:bg-gray-300 transition-colors shadow-lg">
                            ${resetBtnText}
                        </button>
                    </div>
                    
                    <div class="p-4 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm sm:text-base text-gray-800 dark:text-gray-200">
                        ${tipText}
                    </div>
                </main>
            `;
        }
        
        function renderWaterTrackerPage() {
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-blue-600 dark:text-blue-400" id="feature-title">${t.waterSectionTitle}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>
                    
                    <div class="flex flex-col items-center justify-center p-8 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl shadow-lg text-white mb-6">
                        <i class="fas fa-glass-whiskey text-5xl sm:text-7xl mb-4"></i>
                        <div class="text-5xl sm:text-7xl font-extrabold text-shadow">${waterIntake} ml</div>
                    </div>
                    
                    <div class="flex flex-wrap justify-center space-x-2 sm:space-x-4 mb-6">
                        <button onclick="addWater()" class="p-3 px-6 rounded-xl font-bold text-white bg-blue-500 hover:bg-blue-600 transition-colors shadow-lg">
                            ${t.addWaterBtn}
                        </button>
                        <button onclick="resetWater()" class="p-3 px-6 rounded-xl font-bold text-gray-900 bg-gray-200 hover:bg-gray-300 transition-colors shadow-lg">
                            ${t.resetWaterBtn}
                        </button>
                    </div>

                    <div class="p-4 bg-gray-200 dark:bg-gray-700 rounded-lg text-sm sm:text-base text-gray-800 dark:text-gray-200">
                        ${t.waterTipOutputDefault}
                    </div>
                </main>
            `;
        }

        function renderJournalPage() {
            const entriesHtml = journalEntries.length > 0 ? journalEntries.map(entry => `
                <div class="bg-gray-200 dark:bg-gray-700 p-4 rounded-lg">
                    <p class="text-sm font-bold text-gray-600 dark:text-gray-400">${entry.date}</p>
                    <p class="mt-1 text-gray-800 dark:text-gray-200">${entry.entry}</p>
                </div>
            `).join('') : `<p class="text-center text-gray-500 dark:text-gray-400">${t.journalEntriesOutputDefault}</p>`;

            const moodAnalysisHtml = moodAnalysis ? `
                <div class="mt-4 p-4 bg-gray-200 dark:bg-gray-700 rounded-lg">
                    <h4 class="font-bold mb-2">${t.moodAnalysisLabel}</h4>
                    <p class="text-gray-800 dark:text-gray-200">${moodAnalysis}</p>
                </div>
            ` : `<p class="mt-4 text-center text-gray-500 dark:text-gray-400">${t.moodAnalysisOutputDefault}</p>`;

            const loadingHtml = isLoading ? `
                <div class="flex items-center justify-center p-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div>
                    <span class="ml-4 text-indigo-500">${t.loadingText}</span>
                </div>
            ` : '';
            
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-indigo-600 dark:text-indigo-400" id="feature-title">${t.journalSectionTitle}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>

                    <div class="p-6 bg-gradient-to-r from-indigo-400 to-purple-500 dark:from-indigo-600 dark:to-purple-700 rounded-2xl shadow-lg text-white mb-6">
                        <h3 class="text-xl font-bold mb-2">${t.journalDescription}</h3>
                        <div class="flex items-center space-x-2">
                             <textarea id="journalEntryInput" rows="3" placeholder="${t.searchPlaceholder}" class="flex-grow p-3 rounded-lg border-none focus:outline-none text-gray-900 bg-white"></textarea>
                            <button onclick="startListening('journalEntryInput')" class="p-3 bg-indigo-700 hover:bg-indigo-800 transition-colors rounded-lg text-white voice-button ${isListening ? 'listening' : ''}">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                        <div class="flex space-x-2 mt-4">
                            <button onclick="saveJournalEntry()" class="w-full p-3 rounded-xl bg-indigo-700 hover:bg-indigo-800 transition-colors font-bold shadow-md">
                                ${t.saveJournalEntryBtn}
                            </button>
                            <button onclick="analyzeMood()" class="w-full p-3 rounded-xl bg-purple-700 hover:bg-purple-800 transition-colors font-bold shadow-md">
                                ${t.analyzeMoodJournalBtn}
                            </button>
                        </div>
                    </div>
                    
                    ${loadingHtml}
                    
                    <div id="moodAnalysisResult">
                        ${moodAnalysisHtml}
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-indigo-600 dark:text-indigo-400 mt-6">${t.journalEntriesOutputDefault}</h3>
                        ${entriesHtml}
                    </div>
                </main>
            `;
        }

        function renderAiTipPage(featureName, color) {
            const loadingHtml = isSearchLoading ? `
                <div class="flex items-center justify-center p-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-${color}-500"></div>
                    <span class="ml-4 text-${color}-500">${t.searchLoading}</span>
                </div>
            ` : '';
            
            const tipOutputHtml = aiTipOutput ? `
                <div class="mt-4 p-4 bg-gray-200 dark:bg-gray-700 rounded-lg">
                    <p class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${aiTipOutput}</p>
                </div>
                <div class="mt-4 flex justify-end">
                    <button onclick="speakText('${aiTipOutput.replace(/'/g, "\\'")}')" class="p-2 rounded-full bg-${color}-500 text-white hover:bg-${color}-600 transition-colors voice-button ${isSpeaking ? 'speaking' : ''}">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            ` : `<p class="mt-4 text-center text-gray-500 dark:text-gray-400">${t.aiTipPlaceholder}</p>`;

            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-${color}-600 dark:text-${color}-400" id="feature-title">${featureName}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>

                    <div class="flex flex-col space-y-4">
                        <div class="flex items-center space-x-2">
                            <input type="text" id="searchQuery" placeholder="${t.searchPlaceholder}" class="flex-grow p-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-${color}-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                            <button onclick="startListening('searchQuery', (query) => getAiTipForQuery(query, '${featureName}'))" class="p-3 bg-${color}-500 text-white rounded-lg hover:bg-${color}-600 transition-colors voice-button ${isListening ? 'listening' : ''}">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button onclick="getAiTipForQuery(document.getElementById('searchQuery').value, '${featureName}')" class="p-3 bg-${color}-500 text-white rounded-lg hover:bg-${color}-600 transition-colors">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        ${loadingHtml}
                        ${tipOutputHtml}
                    </div>
                </main>
            `;
        }
        
        function renderMedicationReminderPage() {
             const medicationsHtml = medications.length > 0 ? medications.map((med, index) => `
                <div class="flex items-center justify-between p-4 bg-gray-200 dark:bg-gray-700 rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800 dark:text-gray-200">${med.name} - ${med.dosage}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${t.timePlaceholder}: ${med.time}</p>
                    </div>
                    <button onclick="removeMedication(${index})" class="p-2 text-white bg-red-500 rounded-full hover:bg-red-600 transition-colors">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('') : `<p class="text-center text-gray-500 dark:text-gray-400">${t.noMedications}</p>`;
            
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-purple-600 dark:text-purple-400" id="feature-title">${t.medicationReminderLabel}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>
                    
                    <div class="p-6 bg-purple-100 dark:bg-purple-900 rounded-2xl shadow-lg mb-6">
                        <h3 class="text-xl font-bold text-purple-600 dark:text-purple-400 mb-4">${t.medicationTitle}</h3>
                        <div class="space-y-4">
                            <input type="text" id="medicineName" placeholder="${t.medicineNamePlaceholder}" class="w-full p-3 rounded-lg border border-purple-300 dark:border-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                            <input type="text" id="dosage" placeholder="${t.dosagePlaceholder}" class="w-full p-3 rounded-lg border border-purple-300 dark:border-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                            <input type="time" id="medicationTime" placeholder="${t.timePlaceholder}" class="w-full p-3 rounded-lg border border-purple-300 dark:border-purple-600 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                            <button onclick="addMedication()" class="w-full p-3 rounded-xl bg-purple-500 text-white font-bold hover:bg-purple-600 transition-colors shadow-md">
                                ${t.addMedicationBtn}
                            </button>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-bold text-purple-600 dark:text-purple-400 mb-4">${t.medicationListTitle}</h3>
                    <div class="space-y-4">
                        ${medicationsHtml}
                    </div>
                </main>
            `;
        }

        function renderBodyPainMapPage() {
            const painPointsHtml = Object.keys(painPoints).map(part => {
                const description = painPoints[part];
                return `<div class="p-2 bg-red-500 text-white rounded-lg text-sm mb-2">${part}: ${description}</div>`;
            }).join('');
            
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-fuchsia-600 dark:text-fuchsia-400" id="feature-title">${t.bodyPainMappingLabel}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>

                    <div class="p-4 bg-fuchsia-100 dark:bg-fuchsia-900 rounded-2xl shadow-lg flex flex-col items-center">
                        <p class="text-gray-700 dark:text-gray-300 mb-2 text-center">${t.painMapDescription}</p>
                        <p class="text-gray-500 dark:text-gray-400 text-xs mb-4 text-center">${t.painMapNote}</p>
                        <svg class="w-full h-auto max-w-sm" viewBox="0 0 200 400" xmlns="http://www.w3.org/2000/svg" onclick="handlePainPointClick(event)">
                            <style>
                                .body-part { fill: #c084fc; stroke: #a855f7; stroke-width: 1; transition: fill 0.2s; }
                                .body-part:hover { fill: #9333ea; }
                                .pain-point { fill: #ef4444; }
                            </style>
                            <!-- Head -->
                            <path id="head" d="M100 20 C120 20, 130 50, 100 70 C70 50, 80 20, 100 20 Z" class="body-part ${painPoints.head ? 'pain-point' : ''}"></path>
                            <!-- Neck -->
                            <rect id="neck" x="90" y="70" width="20" height="10" class="body-part ${painPoints.neck ? 'pain-point' : ''}"></rect>
                            <!-- Torso -->
                            <path id="torso" d="M80 80 Q100 120, 120 80 L120 200 C120 220, 80 220, 80 200 Z" class="body-part ${painPoints.torso ? 'pain-point' : ''}"></path>
                            <!-- Arms -->
                            <rect id="left-arm" x="65" y="85" width="10" height="115" rx="5" class="body-part ${painPoints['left-arm'] ? 'pain-point' : ''}"></rect>
                            <rect id="right-arm" x="125" y="85" width="10" height="115" rx="5" class="body-part ${painPoints['right-arm'] ? 'pain-point' : ''}"></rect>
                            <!-- Legs -->
                            <rect id="left-leg" x="85" y="220" width="15" height="130" rx="5" class="body-part ${painPoints['left-leg'] ? 'pain-point' : ''}"></rect>
                            <rect id="right-leg" x="100" y="220" width="15" height="130" rx="5" class="body-part ${painPoints['right-leg'] ? 'pain-point' : ''}"></rect>
                            <!-- Hands & Feet (simple circles) -->
                            <circle id="left-hand" cx="70" cy="200" r="5" class="body-part ${painPoints['left-hand'] ? 'pain-point' : ''}"></circle>
                            <circle id="right-hand" cx="130" cy="200" r="5" class="body-part ${painPoints['right-hand'] ? 'pain-point' : ''}"></circle>
                            <circle id="left-foot" cx="92.5" cy="355" r="5" class="body-part ${painPoints['left-foot'] ? 'pain-point' : ''}"></circle>
                            <circle id="right-foot" cx="107.5" cy="355" r="5" class="body-part ${painPoints['right-foot'] ? 'pain-point' : ''}"></circle>
                        </svg>
                    </div>
                </main>
            `;
        }
        
        function renderFirstAidPage() {
             const contactsHtml = emergencyContacts.length > 0 ? emergencyContacts.map((contact, index) => `
                <div class="flex items-center justify-between p-4 bg-gray-200 dark:bg-gray-700 rounded-lg">
                    <div>
                        <p class="font-semibold text-gray-800 dark:text-gray-200">${contact.name}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400">${contact.number}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="callContact('${contact.number}')" class="p-2 text-white bg-green-500 rounded-full hover:bg-green-600 transition-colors">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button onclick="removeEmergencyContact(${index})" class="p-2 text-white bg-red-500 rounded-full hover:bg-red-600 transition-colors">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('') : `<p class="text-center text-gray-500 dark:text-gray-400">அவசர தொடர்புகள் எதுவும் இல்லை.</p>`;
            
            return `
                ${renderHeader()}
                <main class="w-full max-w-4xl p-4 sm:p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl sm:text-3xl font-bold text-red-600 dark:text-red-400" id="feature-title">${t.firstAidEmergencyLabel}</h2>
                        <button onclick="navigateTo('features')" class="p-2 px-4 rounded-full text-sm font-bold bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            ${t.backToFeatures}
                        </button>
                    </div>
                    
                    <div class="p-6 bg-red-100 dark:bg-red-900 rounded-2xl shadow-lg mb-6">
                        <h3 class="text-xl font-bold text-red-600 dark:text-red-400 mb-4">${t.firstAidEmergencyTitle}</h3>
                        <p class="text-gray-700 dark:text-gray-300 mb-4">${t.firstAidDescription}</p>
                        <div class="space-y-4">
                            <input type="text" id="contactName" placeholder="${t.contactNamePlaceholder}" class="w-full p-3 rounded-lg border border-red-300 dark:border-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                            <input type="tel" id="contactNumber" placeholder="${t.contactNumberPlaceholder}" class="w-full p-3 rounded-lg border border-red-300 dark:border-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 bg-gray-50 dark:bg-gray-700 dark:text-gray-100">
                            <button onclick="addEmergencyContact()" class="w-full p-3 rounded-xl bg-red-500 text-white font-bold hover:bg-red-600 transition-colors shadow-md">
                                ${t.addContactBtn}
                            </button>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-bold text-red-600 dark:text-red-400 mb-4">${t.emergencyContactsTitle}</h3>
                    <div class="space-y-4">
                        ${contactsHtml}
                    </div>
                </main>
            `;
        }
        
        function navigateTo(page) {
            currentPage = page;
            renderPage();
            // Reset search output for AI pages
            if (['localTips', 'mealPlan', 'exerciseYoga', 'diseasePrevention', 'wellnessChallenges', 'symptomChecker'].includes(page)) {
                aiTipOutput = '';
            }
        }

        function renderPage() {
            const app = document.getElementById('app');
            let content = '';
            
            switch(currentPage) {
                case 'login':
                    content = renderLoginPage();
                    break;
                case 'main':
                    content = renderMainPage();
                    break;
                case 'features':
                    content = renderFeaturesPage();
                    break;
                case 'foodRecipes':
                    content = renderFoodRecipesPage();
                    break;
                case 'stepTracker':
                    content = renderTrackerPage(
                        t.stepSectionTitle,
                        steps,
                        'படிகள்',
                        t.startTrackingBtn,
                        t.stopTrackingBtn,
                        t.resetStepsBtn,
                        t.stepTipOutputDefault,
                        'startStepTracking()',
                        'stopStepTracking()',
                        'resetSteps()'
                    );
                    break;
                case 'heartRate':
                    content = renderTrackerPage(
                        t.heartRateSectionTitle,
                        heartRate > 0 ? heartRate : t.heartRateResultOutputDefault,
                        'BPM',
                        t.startMeasuringBtn,
                        t.stopMeasuringBtn,
                        t.resetHeartRateBtn,
                        t.heartRateTipOutputDefault,
                        'startHeartRateMeasuring()',
                        'stopHeartRateMeasuring()',
                        'resetHeartRate()'
                    );
                    break;
                case 'waterTracker':
                    content = renderWaterTrackerPage();
                    break;
                case 'journal':
                    content = renderJournalPage();
                    break;
                case 'medicationReminder':
                    content = renderMedicationReminderPage();
                    break;
                case 'bodyPainMap':
                    content = renderBodyPainMapPage();
                    break;
                case 'firstAid':
                    content = renderFirstAidPage();
                    break;
                case 'localTips':
                    content = renderAiTipPage(t.localTipsLabel, 'orange');
                    break;
                case 'mealPlan':
                    content = renderAiTipPage(t.mealPlanLabel, 'teal');
                    break;
                case 'exerciseYoga':
                    content = renderAiTipPage(t.exerciseYogaLabel, 'pink');
                    break;
                case 'diseasePrevention':
                    content = renderAiTipPage(t.diseasePreventionLabel, 'cyan');
                    break;
                case 'wellnessChallenges':
                    content = renderAiTipPage(t.wellnessChallengeLabel, 'lime');
                    break;
                case 'symptomChecker':
                    content = renderAiTipPage(t.symptomCheckerLabel, 'emerald');
                    break;
            }
            app.innerHTML = content.replace(/{{t\.([^}]+)}}/g, (match, key) => t[key] || match);
        }

        // Initial render
        renderPage();
        
    </script>
</body>
</html>
